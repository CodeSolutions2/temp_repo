<!DOCTYPE html>
<html>
<head></head>
<body> 

<div id="counter_display" contenteditable="true" style="display:block; text-align: left; width: 600px;"></div>

<button id="run_counter0" onclick="run_counter0()" style="display:block">run_counter0</button>

<!-- ----------------------------------------------- -->
 
<script defer>

  
// -----------------------------------------------
 
window.addEventListener('beforeunload', function() {
 window.location.href = window.location.href + '?nocache=' + new Date().getTime();
 document.getElementById("counter_display").textContent = 0;
});

// -----------------------------------------------
 
var observer = new MutationObserver(async function(mutationList) {
 
 console.log('inside MutationObserver: ', document.getElementById("counter_display").textContent);

 // The value of a div element is found under (type: childList)
 console.log('mutationList: ', mutationList);

 // Another way to view document.getElementById("counter_display").textContent
 console.log('div value : ', mutationList[0].target.innerHTML);  // or innerText
 
 if (Number(document.getElementById("counter_display").textContent) < 10) {
  await run_counter0();
 } else {
  observer.disconnect();
 }
});

const config = { attributes: true, childList: true, subtree: true };
 
// -----------------------------------------------

async function count_up() {
 // Update the HTML DOM value
 
 // Way 0: with div element
 document.getElementById("counter_display").textContent = await Number(document.getElementById("counter_display").textContent) + 1;

 await new Promise(r => setTimeout(r, 500));
}

// -----------------------------------------------

async function run_counter0() {

 await count_up();

 // -------------------

 // Determine if the HTML DOM value has changed 
 observer.observe(document.getElementById("counter_display"), config);

 // -------------------
}

// -----------------------------------------------
 
</script>
</body>
</html>

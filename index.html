<!DOCTYPE html>
<html>
<head></head>
<body>  

<input id="HF_API_TOKEN" type="text" value="" placeholder="HF_API_TOKEN" rows="10" cols="100" style="display:block; text-align: left; width: 200px;">

<input id="original_sentences" type="text" value="" placeholder="original_sentences" rows="10" cols="100" style="display:block; text-align: left; width: 200px; height: 100px;">

<input id="new_sentences" type="text" value="" placeholder="new_sentences" rows="10" cols="100" style="display:block; text-align: left; width: 200px; height: 100px;">
  
<button id="run_similarity_methods" onclick="run_similarity_methods()">run_similarity_methods</button>


<!-- ---------------------------------------- -->
  
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/universal-sentence-encoder"></script>

<!-- ---------------------------------------- -->

	
<script>


async function run_similarity_methods() {
	
	const original_sentences_array = document.getElementById("original_sentences").value.split('.');
	const new_sentences_array = document.getElementById("new_sentences").value.split('.');

	var best_org_sens = [];
	
	// Goal: which original_sentences_array sentences are similar to each new_sentences_array
	// Pick top 2 similar original_sentences_array sentences for each new_sentences_array
	for (let i=0; i<new_sentences_array.length; i++) {
		
		var sentence0 = new_sentences_array.at(i);
		
		var hf_similarity_temp_org_sen = [];
		for (let j=0; j<original_sentences_array.length; j++) {
			
			var sentence1 = original_sentences_array.at(j);
			
			var hf_similarity = await HF_similarity(sentence0, sentence1);
			hf_similarity_temp_org_sen.push({ind: j, value: hf_similarity});
		}
		// Pick top 2 similar original_sentences_array sentences for each new_sentences_array
		var out = hf_similarity_temp_org_sen.sort((a,b) => a.value - b.value);
		console.log("out: ", out);
		
		var top_2_ind = [out.at(0).ind,  out.at(1).ind];
		var top_2_sen = top_2_ind.map((val, ind) => { return original_sentences_array.at(val); });
		console.log("top_2_sen: ", top_2_sen);

		best_org_sens.push(top_2_sen);
	}

	// Obtain unique sentences of the original best
	best_org_sens = best_org_sens.flat(Infinity);
	var org_sen = [...new Set(best_org_sens)];
	console.log("org_sen: ", org_sen);



	// Simple RAG - make request to LLM with text

	
	
  
}



  

// async function hash_similarity() {
// }



// async function dot_product()
// }



async function cos_sine_similarity(vec0, vec1) {

	// cosine_similarity = (A • B) / (||A|| * ||B||)

	// where (A • B) is the dot product of vectors A and B, and ||A|| and ||B|| are the magnitudes of vectors A and B, respectively.

}


// -------------------------------------------------

async function create_an_embedding(sentences_array) {

  return use.load().then(model => {
			model.embed(sentences_array).then(embeddings => {
				console.log("embeddings: ", embeddings); // 2D tensor [sentences.length, 512]
        return embeddings;
			});
		});
}


// -------------------------------------------------
  
async function HF_similarity(sentence0, sentence1) {


  // https://huggingface.co/docs/api-inference/detailed_parameters

  // -------------------------------------
  
	const HF_API_TOKEN = document.getElementById("HF_API_TOKEN").value;
  
	// -------------------------------------

	var url = `https://api-inference.huggingface.co/models/sentence-transformers/all-MiniLM-L6-v2`;

  // -------------------------------------
  
  var data = {
		"inputs": {"source_sentence": `${sentence0}`, "sentences": [`${sentence1}`]}
	};
  
	// -------------------------------------
  
	var headers_additional = {"Authorization": 'Bearer ' + HF_API_TOKEN};

	// -------------------------------------

	var response = await call_fetch_method(url, data, headers_additional)
		.catch(error => console.error(error));

  console.log('response: ', response);

	// -------------------------------------

  return response;
}



// -------------------------------------------------

  
async function call_fetch_method(url, data, headers_additional) {
	
	const CORS_method_list = ["jQuery_json_POST", "fetch_json_POST"];
	
	var response = undefined;
		
	for (var i=0; i<CORS_method_list.length; i++) {
		try {
			if (i == 0) {
				response = await fetch_json_POST(url, data, headers_additional);
			} else {
				response = await jQuery_json_POST(url, data, headers_additional);
			}
			
		} catch (error) {
			console.log("error: ", error);
		}
		if (response != undefined) {
			break;
		}
	}
	return response;
}

// -----------------------------------------------

async function fetch_json_POST(url, data, headers_additional) {
	
	var headers = {
		"Content-Type": "application/json",
		"Referer": url,
		"Origin": "https://codesolutions2.github.io",
		"Connection": "keep-alive",
		"User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:120.0) Gecko/20100101 Firefox/120.0",
		"Access-Control-Allow-Origin": "*",
	};

  headers = Object.assign({}, headers, headers_additional);
	
	var options = { 
		method : "POST",
		mode: 'cors',
		headers: new Headers(headers),
		cache: "no-cache",
		crossorigin: 'anonymous',
		redirect: "follow",
    body: JSON.stringify(data)
	};
	
	return await fetch(url, options)
		.then(res => res.json())
		.then(obj => { return obj; })
		.catch(error => { console.error("error: ", error); });

}

// -----------------------------------------------

async function jQuery_json_POST(url, data, headers_additional) {
	
	var headers = {
		"Content-Type": "application/json",
		"Referer": url,
		"Origin": "https://codesolutions2.github.io",
		"Connection": "keep-alive",
		"User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:120.0) Gecko/20100101 Firefox/120.0",
		"Access-Control-Allow-Origin": "*",
	};

  headers = Object.assign({}, headers, headers_additional);
	
	var settings = {
		// url: url,
		type : "POST",
		async: true,
		crossDomain: true,
		beforeSend: function(xhr) {xhr.withCredentials = true;},
		headers: new Headers(headers),
    body: JSON.stringify(data),
		xhrFields: {responseType: 'json'},
		dataType: 'json',
		success: function(response) { console.log('Success'); },
		error: function(xhr, status, error) { console.error("error: ", error); }
	};
	
	return $.ajax(url, [,settings]).done(function(response) { return response; });

}

// -----------------------------------------------

</script>
</body>
</html>

<!DOCTYPE html>
<html>
<head></head>
<body>

<input id="url" type="text" value="" placeholder="url" rows="10" cols="100" style="display:block; text-align: left; width: 600px;">

<input id="ys_selected_ColNum" type="text" value="" placeholder="Enter the ys column number (0-n)" rows="10" cols="100" style="display:block; text-align: left; width: 600px;">

<button id="run_selection" onclick="run_selection()">run_selection</button>

<div id="output">


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/knn-classifier"></script>


<script>



async function run_selection() {
	
	// [0] Obtain text data.
	const url = document.getElementById('url').value;
	const ys_selected_ColNum = [Number(document.getElementById('ys_selected_ColNum').value)];

  const data_str = await call_fetch_method(url);

  const headerORnot = "header";
  var [xs, ys] = await parse_text_to_array(data_str, ys_selected_ColNum, headerORnot);	
  document.getElementById("output").innerHTML += "xs and ys row sample: "+xs.at(0).toString()+ys.at(0).toString();
  document.getElementById("output").innerHTML += "<br>";

  document.getElementById("output").innerHTML += "xs.length: "+xs.length.toString();
  document.getElementById("output").innerHTML += "<br>";
 
	
  // Remove a '.' in xs, except for separating sentences.
  const text = await xs.map((sen, i) => { 
	  console.log("sen: ", sen);
	  console.log("sen.length: ", sen.length);
	  return sen.at(0).split('').filter((x) => x != '.').join(''); }).join('.');
  // console.log("text: ", text);

  console.log("text.slice: ", text.split(' ').slice(0,20).join(' '));
  document.getElementById("output").innerHTML += "text0 slice: "+text.split(' ').slice(0,20).join(' ');


  // [1] Transform xs to a numbered count array.
  // const X = await CountVectorization(text);
 
  // document.getElementById("output").innerHTML += "X row sample: "+X.at(0).toString();
  // document.getElementById("output").innerHTML += "<br>";

  // [2] Train an ML model.
  // const result_js1 = await ML_KNN(X, ys);
  // document.getElementById("output").innerHTML += "+result_js1: "+result_js1;
  // document.getElementById("output").innerHTML += "<br>";
  
  // [3] Train a DL model.


} // end of run_selection


async function call_fetch_method(url) {
	
	const CORS_method_list = ["jQuery_csv_GET", "fetch_csv_GET"];
	
	var response = undefined;
		
	for (var i=0; i<CORS_method_list.length; i++) {
		try {
			if (i == 0) {
				response = await fetch_csv_GET(url);
			} else {
				response = await jQuery_csv_GET(url);
			}
			
		} catch (error) {
			console.log("error: ", error);
		}
		if (response != undefined) {
			break;
		}
	}
	return response;
}

// -----------------------------------------------

async function fetch_csv_GET(url) {
	
	var headers = {
		"Content-Type": "application/json",
		"Referer": url,
		"Origin": "https://codesolutions2.github.io",
		"Connection": "keep-alive",
		"User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:120.0) Gecko/20100101 Firefox/120.0",
		"Access-Control-Allow-Origin": "*",
	};
	
	var options = { 
		method : "GET",
		mode: 'cors',
		headers: new Headers(headers),
		cache: "no-cache",
		crossorigin: 'anonymous',
		redirect: "follow"
	};
	
	return await fetch(url, options)
		.then(res => res.text())
		.then(str_data => { return str_data; })
		.catch(error => { console.error("error: ", error); });

}

// -----------------------------------------------

async function jQuery_csv_GET(url) {
	
	var headers = {
		"Content-Type": "application/json",
		"Referer": url,
		"Origin": "https://codesolutions2.github.io",
		"Connection": "keep-alive",
		"User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:120.0) Gecko/20100101 Firefox/120.0",
		"Access-Control-Allow-Origin": "*",
	};
	
	var settings = {
		// url: url,
		type : "GET",
		async: true,
		crossDomain: true,
		beforeSend: function(xhr) {xhr.withCredentials = true;},
		// headers: new Headers(headers),
		xhrFields: {responseType: 'text'},
		dataType: 'text',
		success: function(response) { console.log('Success'); },
		error: function(xhr, status, error) { console.error("error: ", error); }
	};
	
	return $.ajax(url, [,settings]).done(function(response) { return response; });

}

// -----------------------------------------------

async function parse_text_to_array(text_str, ys_selected_ColNum, headerORnot) {
	
	var row_arr = text_str.split('\n');

	if (headerORnot == "no_header") {
		row_arr = row_arr.slice(1,row_arr.length-1);
	}
	// console.log('row_arr: ', row_arr);
	
	var xs = [];
	var ys = [];
	for (let i=0; i<row_arr.length; i++) {
		var col_arr = row_arr[i].split(',');
		// console.log('col_arr: ', col_arr);
		
		var c = 0
		var xs_cols = [];
		var ys_cols = [];
		for (let j=0; j<col_arr.length; j++) {
			
			// Convert strings to number if needed
			var datatype = Number(col_arr[j]) == Number(col_arr[j]) ? Number(col_arr[j]) : String(col_arr[j]);
			// console.log('datatype: ', datatype);
			// console.log('data type [number, string]: ', typeof datatype);
			
			if (j == ys_selected_ColNum[c]) {
				ys_cols.push(datatype);
				c = c + 1;
			} else {
				xs_cols.push(datatype);
			}
		}
		// pack xs and ys
		xs.push(xs_cols);
		ys.push(ys_cols);
	}
	
	return [xs, ys];
}


</script>
</body>
</html>
